export LC_ALL=en_US.UTF-8
export EDITOR=nvim
source ~/.aliases

# C-F for sudo
add_sudo () {
    BUFFER="sudo $BUFFER"
    zle -w end-of-line
}
zle -N add_sudo
bindkey "^F" add_sudo

# Homebrew
export HOMEBREW_NO_ANALYTICS=1

if type brew &>/dev/null; then
  export FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"
fi

# Completions
if type brew &>/dev/null; then
  FPATH=$(brew --prefix)/share/zsh-completions:$FPATH
fi

# FZF
if command -v fzf &> /dev/null; then
  source <(fzf --zsh)
fi

# NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

# Go
export GOPATH="$HOME/go"
export PATH="$PATH:$GOPATH/bin"

# SpoofDPI
# A simple and fast anti-censorship tool written in Go
# https://github.com/xvzc/SpoofDPI
export PATH="$PATH:$HOME/.spoof-dpi/bin"

# Lazygit
export LG_CONFIG_FILE="$HOME/.config/lazygit/config.yml"

# starship
#  â˜„ðŸŒŒï¸ The minimal, blazing-fast, and infinitely customizable prompt for any shell!
#  https://github.com/starship/starship
if command -v starship &> /dev/null; then
  eval "$(starship init zsh)"
fi

# navi
if command -v navi &> /dev/null; then
  eval "$(navi widget zsh)"
fi

# zoxide
if command -v zoxide &> /dev/null; then
  eval "$(zoxide init --cmd j zsh)"
fi

# tabtab source for packages
# uninstall by removing these lines
[[ -f ~/.config/tabtab/zsh/__tabtab.zsh ]] && . ~/.config/tabtab/zsh/__tabtab.zsh || true

# bat
export BAT_THEME="ansi"
# if [[ "$is_dark_mode" == "Dark" ]]; then
#   export BAT_THEME
# else
#   export BAT_THEME
# fi

# klog
if command -v klog &> /dev/null; then
  source <(klog completion -c zsh)
fi

# aider
if [[ "$is_dark_mode" == "Dark" ]]; then
  export AIDER_DARK_MODE=true
else
  export AIDER_DARK_MODE=false
fi

# nvim

# Function to truncate the path to the first letters of directories except the last directory
truncate_path() {
  local path="$1"
  local parts=(${(s:/:)path})  # Split the path into directories
  local truncated_path=""
  local last_part=${parts[-1]}  # Get the last directory

  # Truncate the path to the first letters of directories
  for part in ${parts[1,-2]}; do
    truncated_path+="${part[1]}"
    
    if [[ "$part" != "${parts[-2]}" ]]; then
      truncated_path+="/"
    fi
  done

  # Append the last directory
  truncated_path+=":$last_part"

  echo "$truncated_path"
}

# Function to set the process title based on the current working directory for nvim
set_title_based_on_cwd_for_nvim() {
  local command="$1"
  if [[ "$command" == "nvim" || "$command" == "nv" ]]; then
    local cwd=$(truncate_path "$(pwd)")
    local title="nvim - $cwd"

    echo -n "\e]0;$title\007"
  fi
}

preexec_functions=(set_title_based_on_cwd_for_nvim)

# bit
case ":$PATH:" in
  *":/Users/sea/bin:"*) ;;
  *) export PATH="$PATH:/Users/sea/bin" ;;
esac
# bit end
#compdef bit
###-begin-bit-completions-###
#
# yargs command completion script
#
# Installation: /Users/sea/.bvm/links/bit/node_modules/@teambit/bit/bin/bit completion >> ~/.zshrc
#    or /Users/sea/.bvm/links/bit/node_modules/@teambit/bit/bin/bit completion >> ~/.zsh_profile on OSX.
#
_bit_yargs_completions()
{
  local reply
  local si=$IFS
  IFS=$'
' reply=($(COMP_CWORD="$((CURRENT-1))" COMP_LINE="$BUFFER" COMP_POINT="$CURSOR" /Users/sea/.bvm/links/bit/node_modules/@teambit/bit/bin/bit --get-yargs-completions "${words[@]}"))
  IFS=$si
  _describe 'values' reply
}
compdef _bit_yargs_completions bit
###-end-bit-completions-###
